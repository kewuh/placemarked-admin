import{S as e,i as t,s,d as n,t as a,a as o,w as i,f as r,l,p as c,x as d,c as m,u,g as v,b as p,h as f,y as h,z as g,j as w,k as I,A as E,m as y,o as S,q as j,n as _,r as L,B as T,C as A,e as C,D as x}from"../chunks/Q9p8_eM0.js";import"../chunks/BzQdJGSh.js";import"../chunks/Hbd7jus2.js";import{s as k}from"../chunks/BskyxVM1.js";import{b as D}from"../chunks/UorctoEd.js";function $(e){let t,s,a,o,i,l,c,d,m,u,v,p,C,x,k,D,$,B,F,M,b,N='<h2 class="svelte-12inje5">Admin Access</h2> <p class="svelte-12inje5">Enter the admin password to continue</p>',P="Username",W="Password",H="Sign in",O='<a href="/" class="svelte-12inje5">‚Üê Back to Map</a>',q=e[3]&&V(e);return{c(){t=S("div"),s=S("div"),a=S("div"),a.innerHTML=N,o=j(),i=S("form"),l=S("div"),c=S("label"),c.textContent=P,d=j(),m=S("input"),u=j(),v=S("div"),p=S("label"),p.textContent=W,C=j(),x=S("input"),k=j(),q&&q.c(),D=j(),$=S("button"),$.textContent=H,B=j(),F=S("div"),F.innerHTML=O,this.h()},l(e){t=w(e,"DIV",{class:!0});var r=I(t);s=w(r,"DIV",{class:!0});var f=I(s);a=w(f,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-1utotrw"!==E(a)&&(a.innerHTML=N),o=y(f),i=w(f,"FORM",{});var h=I(i);l=w(h,"DIV",{class:!0});var g=I(l);c=w(g,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),"svelte-1wr0xay"!==E(c)&&(c.textContent=P),d=y(g),m=w(g,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),g.forEach(n),u=y(h),v=w(h,"DIV",{class:!0});var S=I(v);p=w(S,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),"svelte-pepa0a"!==E(p)&&(p.textContent=W),C=y(S),x=w(S,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),S.forEach(n),k=y(h),q&&q.l(h),D=y(h),$=w(h,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),"svelte-13remx3"!==E($)&&($.textContent=H),h.forEach(n),B=y(f),F=w(f,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-17relh6"!==E(F)&&(F.innerHTML=O),f.forEach(n),r.forEach(n),this.h()},h(){g(a,"class","login-header svelte-12inje5"),g(c,"for","username"),g(c,"class","svelte-12inje5"),g(m,"id","username"),g(m,"type","text"),m.required=!0,g(m,"placeholder","Enter username"),g(m,"class","svelte-12inje5"),g(l,"class","form-group svelte-12inje5"),g(p,"for","password"),g(p,"class","svelte-12inje5"),g(x,"id","password"),g(x,"type","password"),x.required=!0,g(x,"placeholder","Enter password"),g(x,"class","svelte-12inje5"),g(v,"class","form-group svelte-12inje5"),g($,"type","submit"),g($,"class","svelte-12inje5"),g(F,"class","login-footer svelte-12inje5"),g(s,"class","login-form svelte-12inje5"),g(t,"class","login-container svelte-12inje5")},m(n,g){r(n,t,g),f(t,s),f(s,a),f(s,o),f(s,i),f(i,l),f(l,c),f(l,d),f(l,m),T(m,e[1]),f(i,u),f(i,v),f(v,p),f(v,C),f(v,x),T(x,e[2]),f(i,k),q&&q.m(i,null),f(i,D),f(i,$),f(s,B),f(s,F),M||(b=[h(m,"input",e[9]),h(x,"input",e[10]),h(i,"submit",A(e[4]))],M=!0)},p(e,t){2&t&&m.value!==e[1]&&T(m,e[1]),4&t&&x.value!==e[2]&&T(x,e[2]),e[3]?q?q.p(e,t):(q=V(e),q.c(),q.m(i,D)):q&&(q.d(1),q=null)},i:_,o:_,d(e){e&&n(t),q&&q.d(),M=!1,L(b)}}}function B(e){let t,s,i,l,c,d,_,L,T,A,C,x,k,D="Placemarked - Admin",$="View Map",B="Logout";const V=e[8].default,F=m(V,e,e[7],null);return{c(){t=S("div"),s=S("div"),i=S("div"),l=S("h1"),l.textContent=D,c=j(),d=S("div"),_=S("a"),_.textContent=$,L=j(),T=S("button"),T.textContent=B,A=j(),F&&F.c(),this.h()},l(e){t=w(e,"DIV",{class:!0});var a=I(t);s=w(a,"DIV",{class:!0});var o=I(s);i=w(o,"DIV",{class:!0});var r=I(i);l=w(r,"H1",{class:!0,"data-svelte-h":!0}),"svelte-1og04w3"!==E(l)&&(l.textContent=D),c=y(r),d=w(r,"DIV",{class:!0});var m=I(d);_=w(m,"A",{href:!0,class:!0,"data-svelte-h":!0}),"svelte-16qhefg"!==E(_)&&(_.textContent=$),L=y(m),T=w(m,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-18t49m"!==E(T)&&(T.textContent=B),m.forEach(n),r.forEach(n),o.forEach(n),A=y(a),F&&F.l(a),a.forEach(n),this.h()},h(){g(l,"class","svelte-12inje5"),g(_,"href","/"),g(_,"class","svelte-12inje5"),g(T,"class","svelte-12inje5"),g(d,"class","admin-nav svelte-12inje5"),g(i,"class","admin-header-content svelte-12inje5"),g(s,"class","admin-header svelte-12inje5"),g(t,"class","admin-layout svelte-12inje5")},m(n,a){r(n,t,a),f(t,s),f(s,i),f(i,l),f(i,c),f(i,d),f(d,_),f(d,L),f(d,T),f(t,A),F&&F.m(t,null),C=!0,x||(k=h(T,"click",e[5]),x=!0)},p(e,t){F&&F.p&&(!C||128&t)&&u(F,V,e,e[7],C?p(V,e[7],t,null):v(e[7]),null)},i(e){C||(o(F,e),C=!0)},o(e){a(F,e),C=!1},d(e){e&&n(t),F&&F.d(e),x=!1,k()}}}function V(e){let t,s;return{c(){t=S("div"),s=c(e[3]),this.h()},l(a){t=w(a,"DIV",{class:!0});var o=I(t);s=l(o,e[3]),o.forEach(n),this.h()},h(){g(t,"class","error-message svelte-12inje5")},m(e,n){r(e,t,n),f(t,s)},p(e,t){8&t&&C(s,e[3])},d(e){e&&n(t)}}}function F(e){let t,s,d,m;const u=[B,$],v=[];function p(e,t){return e[0]?0:1}return t=p(e),s=v[t]=u[t](e),{c(){s.c(),d=c("\n\n\n// Force redeploy for title fix\n// Force cache clear\n// Force new deployment Wed Aug 27 16:57:34 BST 2025\n// Force fresh deployment Wed Aug 27 17:04:41 BST 2025\n// FORCE NEW DEPLOYMENT - Wed Aug 27 17:11:36 BST 2025 - CLEAR ALL CACHES")},l(e){s.l(e),d=l(e,"\n\n\n// Force redeploy for title fix\n// Force cache clear\n// Force new deployment Wed Aug 27 16:57:34 BST 2025\n// Force fresh deployment Wed Aug 27 17:04:41 BST 2025\n// FORCE NEW DEPLOYMENT - Wed Aug 27 17:11:36 BST 2025 - CLEAR ALL CACHES")},m(e,s){v[t].m(e,s),r(e,d,s),m=!0},p(e,[n]){let r=t;t=p(e),t===r?v[t].p(e,n):(x(),a(v[r],1,1,()=>{v[r]=null}),i(),s=v[t],s?s.p(e,n):(s=v[t]=u[t](e),s.c()),o(s,1),s.m(d.parentNode,d))},i(e){m||(o(s),m=!0)},o(e){a(s),m=!1},d(e){e&&n(d),v[t].d(e)}}}function M(e,t,s){let{$$slots:n={},$$scope:a}=t,o=!1,i="",r="",l="",c=0,m=!1,u=0;function v(){c++,"undefined"!=typeof window&&sessionStorage.setItem("admin_login_attempts",c.toString()),c>=5&&(m=!0,u=Date.now()+9e5,"undefined"!=typeof window&&sessionStorage.setItem("admin_lockout_until",u.toString()),s(3,l="Too many failed attempts. Account locked for 15 minutes."))}function p(){s(0,o=!1),"undefined"!=typeof window&&(sessionStorage.removeItem("admin_authenticated"),sessionStorage.removeItem("admin_username"),sessionStorage.removeItem("admin_login_time")),s(1,i=""),s(2,r="")}let f;function h(){f&&clearTimeout(f),o&&s(6,f=setTimeout(()=>{p()},18e5))}function g(){h()}return d(()=>{if("undefined"==typeof window)return;const e=sessionStorage.getItem("admin_authenticated"),t=sessionStorage.getItem("admin_login_time");if("true"===e&&t){Date.now()-parseInt(t)<288e5?s(0,o=!0):p()}const n=sessionStorage.getItem("admin_lockout_until");if(n){const e=parseInt(n);Date.now()<e?(m=!0,u=e):(sessionStorage.removeItem("admin_lockout_until"),sessionStorage.removeItem("admin_login_attempts"))}const a=sessionStorage.getItem("admin_login_attempts");a&&(c=parseInt(a))}),e.$$set=e=>{"$$scope"in e&&s(7,a=e.$$scope)},e.$$.update=()=>{65&e.$$.dirty&&(o&&"undefined"!=typeof document?(h(),document.addEventListener("mousemove",g),document.addEventListener("keypress",g),document.addEventListener("click",g)):"undefined"!=typeof document&&(f&&clearTimeout(f),document.removeEventListener("mousemove",g),document.removeEventListener("keypress",g),document.removeEventListener("click",g)))},[o,i,r,l,async function(){if(m){const e=Math.ceil((u-Date.now())/1e3/60);return void s(3,l=`Account locked. Try again in ${e} minutes.`)}if(i.trim()&&r.trim())try{const{data:e,error:t}=await k.from("moderators").select("id, username, password").eq("username",i.trim()).single();if(t||!e)return v(),void s(3,l="Invalid username or password");await D.compare(r.trim(),e.password||"")?(s(0,o=!0),"undefined"!=typeof window&&(sessionStorage.setItem("admin_authenticated","true"),sessionStorage.setItem("admin_username",e.username||""),sessionStorage.setItem("admin_login_time",Date.now().toString()),sessionStorage.removeItem("admin_login_attempts"),sessionStorage.removeItem("admin_lockout_until")),c=0,m=!1,s(3,l="")):(v(),s(3,l="Invalid username or password"))}catch(e){v(),s(3,l="Login failed. Please try again.")}else s(3,l="Please enter both username and password")},p,f,a,n,function(){i=this.value,s(1,i)},function(){r=this.value,s(2,r)}]}class b extends e{constructor(e){super(),t(this,e,M,F,s,{})}}export{b as component};
