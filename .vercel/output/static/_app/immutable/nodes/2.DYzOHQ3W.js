import{S as e,i as t,s,d as n,t as a,a as o,w as i,f as r,l,p as c,x as d,c as m,u,g as v,b as p,h as f,y as h,z as g,j as I,k as w,A as j,m as _,o as y,q as E,n as S,r as x,B as k,C as D,e as L,D as T}from"../chunks/Q9p8_eM0.js";import"../chunks/BzQdJGSh.js";import"../chunks/syUEOhLk.js";import{s as $}from"../chunks/BskyxVM1.js";import{b as C}from"../chunks/UorctoEd.js";function V(e){let t,s,a,o,i,l,c,d,m,u,v,p,L,T,$,C,V,b,M,q,B,U='<h2 class="svelte-12inje5">Admin Access</h2> <p class="svelte-12inje5">Enter the admin password to continue</p>',F="Username",H="Password",N="Sign in",P='<a href="/" class="svelte-12inje5">‚Üê Back to Map</a>',O=e[3]&&A(e);return{c(){t=y("div"),s=y("div"),a=y("div"),a.innerHTML=U,o=E(),i=y("form"),l=y("div"),c=y("label"),c.textContent=F,d=E(),m=y("input"),u=E(),v=y("div"),p=y("label"),p.textContent=H,L=E(),T=y("input"),$=E(),O&&O.c(),C=E(),V=y("button"),V.textContent=N,b=E(),M=y("div"),M.innerHTML=P,this.h()},l(e){t=I(e,"DIV",{class:!0});var r=w(t);s=I(r,"DIV",{class:!0});var f=w(s);a=I(f,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-1utotrw"!==j(a)&&(a.innerHTML=U),o=_(f),i=I(f,"FORM",{});var h=w(i);l=I(h,"DIV",{class:!0});var g=w(l);c=I(g,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),"svelte-1wr0xay"!==j(c)&&(c.textContent=F),d=_(g),m=I(g,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),g.forEach(n),u=_(h),v=I(h,"DIV",{class:!0});var y=w(v);p=I(y,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),"svelte-pepa0a"!==j(p)&&(p.textContent=H),L=_(y),T=I(y,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),y.forEach(n),$=_(h),O&&O.l(h),C=_(h),V=I(h,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),"svelte-13remx3"!==j(V)&&(V.textContent=N),h.forEach(n),b=_(f),M=I(f,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-17relh6"!==j(M)&&(M.innerHTML=P),f.forEach(n),r.forEach(n),this.h()},h(){g(a,"class","login-header svelte-12inje5"),g(c,"for","username"),g(c,"class","svelte-12inje5"),g(m,"id","username"),g(m,"type","text"),m.required=!0,g(m,"placeholder","Enter username"),g(m,"class","svelte-12inje5"),g(l,"class","form-group svelte-12inje5"),g(p,"for","password"),g(p,"class","svelte-12inje5"),g(T,"id","password"),g(T,"type","password"),T.required=!0,g(T,"placeholder","Enter password"),g(T,"class","svelte-12inje5"),g(v,"class","form-group svelte-12inje5"),g(V,"type","submit"),g(V,"class","svelte-12inje5"),g(M,"class","login-footer svelte-12inje5"),g(s,"class","login-form svelte-12inje5"),g(t,"class","login-container svelte-12inje5")},m(n,g){r(n,t,g),f(t,s),f(s,a),f(s,o),f(s,i),f(i,l),f(l,c),f(l,d),f(l,m),k(m,e[1]),f(i,u),f(i,v),f(v,p),f(v,L),f(v,T),k(T,e[2]),f(i,$),O&&O.m(i,null),f(i,C),f(i,V),f(s,b),f(s,M),q||(B=[h(m,"input",e[9]),h(T,"input",e[10]),h(i,"submit",D(e[4]))],q=!0)},p(e,t){2&t&&m.value!==e[1]&&k(m,e[1]),4&t&&T.value!==e[2]&&k(T,e[2]),e[3]?O?O.p(e,t):(O=A(e),O.c(),O.m(i,C)):O&&(O.d(1),O=null)},i:S,o:S,d(e){e&&n(t),O&&O.d(),q=!1,x(B)}}}function b(e){let t,s,i,l,c,d,S,x,k,D,L,T,$,C="UK Queering Map - Admin",V="View Map",b="Logout";const A=e[8].default,M=m(A,e,e[7],null);return{c(){t=y("div"),s=y("div"),i=y("div"),l=y("h1"),l.textContent=C,c=E(),d=y("div"),S=y("a"),S.textContent=V,x=E(),k=y("button"),k.textContent=b,D=E(),M&&M.c(),this.h()},l(e){t=I(e,"DIV",{class:!0});var a=w(t);s=I(a,"DIV",{class:!0});var o=w(s);i=I(o,"DIV",{class:!0});var r=w(i);l=I(r,"H1",{class:!0,"data-svelte-h":!0}),"svelte-1rl2irq"!==j(l)&&(l.textContent=C),c=_(r),d=I(r,"DIV",{class:!0});var m=w(d);S=I(m,"A",{href:!0,class:!0,"data-svelte-h":!0}),"svelte-16qhefg"!==j(S)&&(S.textContent=V),x=_(m),k=I(m,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-18t49m"!==j(k)&&(k.textContent=b),m.forEach(n),r.forEach(n),o.forEach(n),D=_(a),M&&M.l(a),a.forEach(n),this.h()},h(){g(l,"class","svelte-12inje5"),g(S,"href","/"),g(S,"class","svelte-12inje5"),g(k,"class","svelte-12inje5"),g(d,"class","admin-nav svelte-12inje5"),g(i,"class","admin-header-content svelte-12inje5"),g(s,"class","admin-header svelte-12inje5"),g(t,"class","admin-layout svelte-12inje5")},m(n,a){r(n,t,a),f(t,s),f(s,i),f(i,l),f(i,c),f(i,d),f(d,S),f(d,x),f(d,k),f(t,D),M&&M.m(t,null),L=!0,T||($=h(k,"click",e[5]),T=!0)},p(e,t){M&&M.p&&(!L||128&t)&&u(M,A,e,e[7],L?p(A,e[7],t,null):v(e[7]),null)},i(e){L||(o(M,e),L=!0)},o(e){a(M,e),L=!1},d(e){e&&n(t),M&&M.d(e),T=!1,$()}}}function A(e){let t,s;return{c(){t=y("div"),s=c(e[3]),this.h()},l(a){t=I(a,"DIV",{class:!0});var o=w(t);s=l(o,e[3]),o.forEach(n),this.h()},h(){g(t,"class","error-message svelte-12inje5")},m(e,n){r(e,t,n),f(t,s)},p(e,t){8&t&&L(s,e[3])},d(e){e&&n(t)}}}function M(e){let t,s,d,m;const u=[b,V],v=[];function p(e,t){return e[0]?0:1}return t=p(e),s=v[t]=u[t](e),{c(){s.c(),d=c("\n\n\n// Force redeploy for title fix\n// Force cache clear")},l(e){s.l(e),d=l(e,"\n\n\n// Force redeploy for title fix\n// Force cache clear")},m(e,s){v[t].m(e,s),r(e,d,s),m=!0},p(e,[n]){let r=t;t=p(e),t===r?v[t].p(e,n):(T(),a(v[r],1,1,()=>{v[r]=null}),i(),s=v[t],s?s.p(e,n):(s=v[t]=u[t](e),s.c()),o(s,1),s.m(d.parentNode,d))},i(e){m||(o(s),m=!0)},o(e){a(s),m=!1},d(e){e&&n(d),v[t].d(e)}}}function q(e,t,s){let{$$slots:n={},$$scope:a}=t,o=!1,i="",r="",l="",c=0,m=!1,u=0;function v(){c++,"undefined"!=typeof window&&sessionStorage.setItem("admin_login_attempts",c.toString()),c>=5&&(m=!0,u=Date.now()+9e5,"undefined"!=typeof window&&sessionStorage.setItem("admin_lockout_until",u.toString()),s(3,l="Too many failed attempts. Account locked for 15 minutes."))}function p(){s(0,o=!1),"undefined"!=typeof window&&(sessionStorage.removeItem("admin_authenticated"),sessionStorage.removeItem("admin_username"),sessionStorage.removeItem("admin_login_time")),s(1,i=""),s(2,r="")}let f;function h(){f&&clearTimeout(f),o&&s(6,f=setTimeout(()=>{p()},18e5))}function g(){h()}return d(()=>{if("undefined"==typeof window)return;const e=sessionStorage.getItem("admin_authenticated"),t=sessionStorage.getItem("admin_login_time");if("true"===e&&t){Date.now()-parseInt(t)<288e5?s(0,o=!0):p()}const n=sessionStorage.getItem("admin_lockout_until");if(n){const e=parseInt(n);Date.now()<e?(m=!0,u=e):(sessionStorage.removeItem("admin_lockout_until"),sessionStorage.removeItem("admin_login_attempts"))}const a=sessionStorage.getItem("admin_login_attempts");a&&(c=parseInt(a))}),e.$$set=e=>{"$$scope"in e&&s(7,a=e.$$scope)},e.$$.update=()=>{65&e.$$.dirty&&(o&&"undefined"!=typeof document?(h(),document.addEventListener("mousemove",g),document.addEventListener("keypress",g),document.addEventListener("click",g)):"undefined"!=typeof document&&(f&&clearTimeout(f),document.removeEventListener("mousemove",g),document.removeEventListener("keypress",g),document.removeEventListener("click",g)))},[o,i,r,l,async function(){if(m){const e=Math.ceil((u-Date.now())/1e3/60);return void s(3,l=`Account locked. Try again in ${e} minutes.`)}if(i.trim()&&r.trim())try{const{data:e,error:t}=await $.from("moderators").select("id, username, password").eq("username",i.trim()).single();if(t||!e)return v(),void s(3,l="Invalid username or password");await C.compare(r.trim(),e.password||"")?(s(0,o=!0),"undefined"!=typeof window&&(sessionStorage.setItem("admin_authenticated","true"),sessionStorage.setItem("admin_username",e.username||""),sessionStorage.setItem("admin_login_time",Date.now().toString()),sessionStorage.removeItem("admin_login_attempts"),sessionStorage.removeItem("admin_lockout_until")),c=0,m=!1,s(3,l="")):(v(),s(3,l="Invalid username or password"))}catch(e){v(),s(3,l="Login failed. Please try again.")}else s(3,l="Please enter both username and password")},p,f,a,n,function(){i=this.value,s(1,i)},function(){r=this.value,s(2,r)}]}class B extends e{constructor(e){super(),t(this,e,q,M,s,{})}}export{B as component};
