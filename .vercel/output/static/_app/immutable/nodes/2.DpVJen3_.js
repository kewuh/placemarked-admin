import{S as e,i as t,s,d as n,t as a,a as o,w as i,f as r,x as l,y as c,c as d,u as m,g as u,b as v,h as p,z as f,A as h,j as g,k as I,B as w,m as j,o as _,q as y,n as E,r as S,C as k,D as x,e as D,l as L,p as T,E as $}from"../chunks/DtDmOkZC.js";import"../chunks/BzQdJGSh.js";import"../chunks/C5LTyy05.js";import{s as C}from"../chunks/BskyxVM1.js";import{b as V}from"../chunks/UorctoEd.js";function b(e){let t,s,a,o,i,l,c,d,m,u,v,D,L,T,$,C,V,b,A,q,B,U='<h2 class="svelte-12inje5">Admin Access</h2> <p class="svelte-12inje5">Enter the admin password to continue</p>',H="Username",N="Password",P="Sign in",O='<a href="/" class="svelte-12inje5">‚Üê Back to Map</a>',z=e[3]&&M(e);return{c(){t=_("div"),s=_("div"),a=_("div"),a.innerHTML=U,o=y(),i=_("form"),l=_("div"),c=_("label"),c.textContent=H,d=y(),m=_("input"),u=y(),v=_("div"),D=_("label"),D.textContent=N,L=y(),T=_("input"),$=y(),z&&z.c(),C=y(),V=_("button"),V.textContent=P,b=y(),A=_("div"),A.innerHTML=O,this.h()},l(e){t=g(e,"DIV",{class:!0});var r=I(t);s=g(r,"DIV",{class:!0});var p=I(s);a=g(p,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-1utotrw"!==w(a)&&(a.innerHTML=U),o=j(p),i=g(p,"FORM",{});var f=I(i);l=g(f,"DIV",{class:!0});var h=I(l);c=g(h,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),"svelte-1wr0xay"!==w(c)&&(c.textContent=H),d=j(h),m=g(h,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),h.forEach(n),u=j(f),v=g(f,"DIV",{class:!0});var _=I(v);D=g(_,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),"svelte-pepa0a"!==w(D)&&(D.textContent=N),L=j(_),T=g(_,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),_.forEach(n),$=j(f),z&&z.l(f),C=j(f),V=g(f,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),"svelte-13remx3"!==w(V)&&(V.textContent=P),f.forEach(n),b=j(p),A=g(p,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-17relh6"!==w(A)&&(A.innerHTML=O),p.forEach(n),r.forEach(n),this.h()},h(){h(a,"class","login-header svelte-12inje5"),h(c,"for","username"),h(c,"class","svelte-12inje5"),h(m,"id","username"),h(m,"type","text"),m.required=!0,h(m,"placeholder","Enter username"),h(m,"class","svelte-12inje5"),h(l,"class","form-group svelte-12inje5"),h(D,"for","password"),h(D,"class","svelte-12inje5"),h(T,"id","password"),h(T,"type","password"),T.required=!0,h(T,"placeholder","Enter password"),h(T,"class","svelte-12inje5"),h(v,"class","form-group svelte-12inje5"),h(V,"type","submit"),h(V,"class","svelte-12inje5"),h(A,"class","login-footer svelte-12inje5"),h(s,"class","login-form svelte-12inje5"),h(t,"class","login-container svelte-12inje5")},m(n,h){r(n,t,h),p(t,s),p(s,a),p(s,o),p(s,i),p(i,l),p(l,c),p(l,d),p(l,m),k(m,e[1]),p(i,u),p(i,v),p(v,D),p(v,L),p(v,T),k(T,e[2]),p(i,$),z&&z.m(i,null),p(i,C),p(i,V),p(s,b),p(s,A),q||(B=[f(m,"input",e[9]),f(T,"input",e[10]),f(i,"submit",x(e[4]))],q=!0)},p(e,t){2&t&&m.value!==e[1]&&k(m,e[1]),4&t&&T.value!==e[2]&&k(T,e[2]),e[3]?z?z.p(e,t):(z=M(e),z.c(),z.m(i,C)):z&&(z.d(1),z=null)},i:E,o:E,d(e){e&&n(t),z&&z.d(),q=!1,S(B)}}}function A(e){let t,s,i,l,c,E,S,k,x,D,L,T,$,C="UK Queering Map - Admin",V="View Map",b="Logout";const A=e[8].default,M=d(A,e,e[7],null);return{c(){t=_("div"),s=_("div"),i=_("div"),l=_("h1"),l.textContent=C,c=y(),E=_("div"),S=_("a"),S.textContent=V,k=y(),x=_("button"),x.textContent=b,D=y(),M&&M.c(),this.h()},l(e){t=g(e,"DIV",{class:!0});var a=I(t);s=g(a,"DIV",{class:!0});var o=I(s);i=g(o,"DIV",{class:!0});var r=I(i);l=g(r,"H1",{class:!0,"data-svelte-h":!0}),"svelte-1rl2irq"!==w(l)&&(l.textContent=C),c=j(r),E=g(r,"DIV",{class:!0});var d=I(E);S=g(d,"A",{href:!0,class:!0,"data-svelte-h":!0}),"svelte-16qhefg"!==w(S)&&(S.textContent=V),k=j(d),x=g(d,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-18t49m"!==w(x)&&(x.textContent=b),d.forEach(n),r.forEach(n),o.forEach(n),D=j(a),M&&M.l(a),a.forEach(n),this.h()},h(){h(l,"class","svelte-12inje5"),h(S,"href","/"),h(S,"class","svelte-12inje5"),h(x,"class","svelte-12inje5"),h(E,"class","admin-nav svelte-12inje5"),h(i,"class","admin-header-content svelte-12inje5"),h(s,"class","admin-header svelte-12inje5"),h(t,"class","admin-layout svelte-12inje5")},m(n,a){r(n,t,a),p(t,s),p(s,i),p(i,l),p(i,c),p(i,E),p(E,S),p(E,k),p(E,x),p(t,D),M&&M.m(t,null),L=!0,T||($=f(x,"click",e[5]),T=!0)},p(e,t){M&&M.p&&(!L||128&t)&&m(M,A,e,e[7],L?v(A,e[7],t,null):u(e[7]),null)},i(e){L||(o(M,e),L=!0)},o(e){a(M,e),L=!1},d(e){e&&n(t),M&&M.d(e),T=!1,$()}}}function M(e){let t,s;return{c(){t=_("div"),s=T(e[3]),this.h()},l(a){t=g(a,"DIV",{class:!0});var o=I(t);s=L(o,e[3]),o.forEach(n),this.h()},h(){h(t,"class","error-message svelte-12inje5")},m(e,n){r(e,t,n),p(t,s)},p(e,t){8&t&&D(s,e[3])},d(e){e&&n(t)}}}function q(e){let t,s,c,d;const m=[A,b],u=[];function v(e,t){return e[0]?0:1}return t=v(e),s=u[t]=m[t](e),{c(){s.c(),c=l()},l(e){s.l(e),c=l()},m(e,s){u[t].m(e,s),r(e,c,s),d=!0},p(e,[n]){let r=t;t=v(e),t===r?u[t].p(e,n):($(),a(u[r],1,1,()=>{u[r]=null}),i(),s=u[t],s?s.p(e,n):(s=u[t]=m[t](e),s.c()),o(s,1),s.m(c.parentNode,c))},i(e){d||(o(s),d=!0)},o(e){a(s),d=!1},d(e){e&&n(c),u[t].d(e)}}}function B(e,t,s){let{$$slots:n={},$$scope:a}=t,o=!1,i="",r="",l="",d=0,m=!1,u=0;function v(){d++,"undefined"!=typeof window&&sessionStorage.setItem("admin_login_attempts",d.toString()),d>=5&&(m=!0,u=Date.now()+9e5,"undefined"!=typeof window&&sessionStorage.setItem("admin_lockout_until",u.toString()),s(3,l="Too many failed attempts. Account locked for 15 minutes."))}function p(){s(0,o=!1),"undefined"!=typeof window&&(sessionStorage.removeItem("admin_authenticated"),sessionStorage.removeItem("admin_username"),sessionStorage.removeItem("admin_login_time")),s(1,i=""),s(2,r="")}let f;function h(){f&&clearTimeout(f),o&&s(6,f=setTimeout(()=>{p()},18e5))}function g(){h()}return c(()=>{if("undefined"==typeof window)return;const e=sessionStorage.getItem("admin_authenticated"),t=sessionStorage.getItem("admin_login_time");if("true"===e&&t){Date.now()-parseInt(t)<288e5?s(0,o=!0):p()}const n=sessionStorage.getItem("admin_lockout_until");if(n){const e=parseInt(n);Date.now()<e?(m=!0,u=e):(sessionStorage.removeItem("admin_lockout_until"),sessionStorage.removeItem("admin_login_attempts"))}const a=sessionStorage.getItem("admin_login_attempts");a&&(d=parseInt(a))}),e.$$set=e=>{"$$scope"in e&&s(7,a=e.$$scope)},e.$$.update=()=>{65&e.$$.dirty&&(o&&"undefined"!=typeof document?(h(),document.addEventListener("mousemove",g),document.addEventListener("keypress",g),document.addEventListener("click",g)):"undefined"!=typeof document&&(f&&clearTimeout(f),document.removeEventListener("mousemove",g),document.removeEventListener("keypress",g),document.removeEventListener("click",g)))},[o,i,r,l,async function(){if(m){const e=Math.ceil((u-Date.now())/1e3/60);return void s(3,l=`Account locked. Try again in ${e} minutes.`)}if(i.trim()&&r.trim())try{const{data:e,error:t}=await C.from("moderators").select("id, username, password").eq("username",i.trim()).single();if(t||!e)return v(),void s(3,l="Invalid username or password");await V.compare(r.trim(),e.password||"")?(s(0,o=!0),"undefined"!=typeof window&&(sessionStorage.setItem("admin_authenticated","true"),sessionStorage.setItem("admin_username",e.username||""),sessionStorage.setItem("admin_login_time",Date.now().toString()),sessionStorage.removeItem("admin_login_attempts"),sessionStorage.removeItem("admin_lockout_until")),d=0,m=!1,s(3,l="")):(v(),s(3,l="Invalid username or password"))}catch(e){v(),s(3,l="Login failed. Please try again.")}else s(3,l="Please enter both username and password")},p,f,a,n,function(){i=this.value,s(1,i)},function(){r=this.value,s(2,r)}]}class U extends e{constructor(e){super(),t(this,e,B,q,s,{})}}export{U as component};
