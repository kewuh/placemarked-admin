import{S as e,i as t,s,n as a,d as n,r as o,C as l,f as r,h as c,z as i,A as d,F as h,m as u,j as m,k as v,B as f,q as p,o as q,y as z,e as w,l as T,p as g,x as b}from"../chunks/DtDmOkZC.js";import{e as E,u as y,d as k}from"../chunks/DBMzglTz.js";import"../chunks/BzQdJGSh.js";import{s as x}from"../chunks/BskyxVM1.js";import{b as D}from"../chunks/UorctoEd.js";function C(e,t,s){const a=e.slice();return a[21]=t[s],a}function N(e){let t,s;return{c(){t=q("div"),s=g(e[2]),this.h()},l(a){t=m(a,"DIV",{class:!0});var o=v(t);s=T(o,e[2]),o.forEach(n),this.h()},h(){d(t,"class","error-alert svelte-8eq6zo")},m(e,a){r(e,t,a),c(t,s)},p(e,t){4&t&&w(s,e[2])},d(e){e&&n(t)}}}function I(e){let t,s,a,o,l,i,h,z='<tr class="svelte-8eq6zo"><th class="svelte-8eq6zo">Username</th> <th class="svelte-8eq6zo">Password</th> <th class="svelte-8eq6zo">ID</th> <th class="svelte-8eq6zo">Created</th> <th class="svelte-8eq6zo">Actions</th></tr>',w=[],T=new Map,g=E(e[0]);const x=e=>e[21].id;for(let n=0;n<g.length;n+=1){let t=C(e,g,n),s=x(t);T.set(s,w[n]=H(s,t))}let D=0===e[0].length&&P();return{c(){t=q("div"),s=q("table"),a=q("thead"),a.innerHTML=z,o=p(),l=q("tbody");for(let e=0;e<w.length;e+=1)w[e].c();i=p(),D&&D.c(),h=b(),this.h()},l(e){t=m(e,"DIV",{class:!0});var r=v(t);s=m(r,"TABLE",{class:!0});var c=v(s);a=m(c,"THEAD",{"data-svelte-h":!0}),"svelte-1jmmjb7"!==f(a)&&(a.innerHTML=z),o=u(c),l=m(c,"TBODY",{});var d=v(l);for(let t=0;t<w.length;t+=1)w[t].l(d);d.forEach(n),c.forEach(n),r.forEach(n),i=u(e),D&&D.l(e),h=b(),this.h()},h(){d(s,"class","admin-table svelte-8eq6zo"),d(t,"class","table-container svelte-8eq6zo")},m(e,n){r(e,t,n),c(t,s),c(s,a),c(s,o),c(s,l);for(let t=0;t<w.length;t+=1)w[t]&&w[t].m(l,null);r(e,i,n),D&&D.m(e,n),r(e,h,n)},p(e,t){7905&t&&(g=E(e[0]),w=y(w,t,x,1,e,g,T,l,k,H,null,C)),0===e[0].length?D||(D=P(),D.c(),D.m(h.parentNode,h)):D&&(D.d(1),D=null)},d(e){e&&(n(t),n(i),n(h));for(let t=0;t<w.length;t+=1)w[t].d();D&&D.d(e)}}}function U(e){let t,s='<div class="loading-spinner svelte-8eq6zo"></div> <p>Loading moderators...</p>';return{c(){t=q("div"),t.innerHTML=s,this.h()},l(e){t=m(e,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-1qmbpo4"!==f(t)&&(t.innerHTML=s),this.h()},h(){d(t,"class","loading-container svelte-8eq6zo")},m(e,s){r(e,t,s)},p:a,d(e){e&&n(t)}}}function A(e){let t,s=(e[21].username||"No username")+"";return{c(){t=g(s)},l(e){t=T(e,s)},m(e,s){r(e,t,s)},p(e,a){1&a&&s!==(s=(e[21].username||"No username")+"")&&w(t,s)},d(e){e&&n(t)}}}function L(e){let t,s,a;return{c(){t=q("input"),this.h()},l(e){t=m(e,"INPUT",{placeholder:!0,class:!0}),this.h()},h(){d(t,"placeholder","Username"),d(t,"class","svelte-8eq6zo")},m(n,o){r(n,t,o),l(t,e[6]),s||(a=i(t,"input",e[16]),s=!0)},p(e,s){64&s&&t.value!==e[6]&&l(t,e[6])},d(e){e&&n(t),s=!1,a()}}}function M(e){let t,s=e[21].password?"••••••••":"No password";return{c(){t=g(s)},l(e){t=T(e,s)},m(e,s){r(e,t,s)},p(e,a){1&a&&s!==(s=e[21].password?"••••••••":"No password")&&w(t,s)},d(e){e&&n(t)}}}function j(e){let t,s,a;return{c(){t=q("input"),this.h()},l(e){t=m(e,"INPUT",{type:!0,placeholder:!0,class:!0}),this.h()},h(){d(t,"type","password"),d(t,"placeholder","New password (leave blank to keep current)"),d(t,"class","svelte-8eq6zo")},m(n,o){r(n,t,o),l(t,e[7]),s||(a=i(t,"input",e[17]),s=!0)},p(e,s){128&s&&t.value!==e[7]&&l(t,e[7])},d(e){e&&n(t),s=!1,a()}}}function B(e){let t,s,a,l,c,h="Edit",v="Delete";function z(){return e[18](e[21])}function w(){return e[19](e[21])}return{c(){t=q("button"),t.textContent=h,s=p(),a=q("button"),a.textContent=v,this.h()},l(e){t=m(e,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-ic1phu"!==f(t)&&(t.textContent=h),s=u(e),a=m(e,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-djks9n"!==f(a)&&(a.textContent=v),this.h()},h(){d(t,"class","btn btn-edit svelte-8eq6zo"),d(a,"class","btn btn-delete svelte-8eq6zo")},m(e,n){r(e,t,n),r(e,s,n),r(e,a,n),l||(c=[i(t,"click",z),i(a,"click",w)],l=!0)},p(t,s){e=t},d(e){e&&(n(t),n(s),n(a)),l=!1,o(c)}}}function V(e){let t,s,l,c,h,v="Save",z="Cancel";return{c(){t=q("button"),t.textContent=v,s=p(),l=q("button"),l.textContent=z,this.h()},l(e){t=m(e,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-1txxts7"!==f(t)&&(t.textContent=v),s=u(e),l=m(e,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-gi3vpc"!==f(l)&&(l.textContent=z),this.h()},h(){d(t,"class","btn btn-save svelte-8eq6zo"),d(l,"class","btn btn-cancel svelte-8eq6zo")},m(a,n){r(a,t,n),r(a,s,n),r(a,l,n),c||(h=[i(t,"click",e[11]),i(l,"click",e[10])],c=!0)},p:a,d(e){e&&(n(t),n(s),n(l)),c=!1,o(h)}}}function H(e,t){let s,a,o,l,i,h,f,z,b,E,y,k,x,D=t[21].id+"",C=F(t[21].created_at)+"";function N(e,t){return e[5]?.id===e[21].id?L:A}let I=N(t),U=I(t);function H(e,t){return e[5]?.id===e[21].id?j:M}let P=H(t),O=P(t);function S(e,t){return e[5]?.id===e[21].id?V:B}let _=S(t),R=_(t);return{key:e,first:null,c(){s=q("tr"),a=q("td"),U.c(),o=p(),l=q("td"),O.c(),i=p(),h=q("td"),f=g(D),z=p(),b=q("td"),E=g(C),y=p(),k=q("td"),R.c(),x=p(),this.h()},l(e){s=m(e,"TR",{class:!0});var t=v(s);a=m(t,"TD",{class:!0});var r=v(a);U.l(r),r.forEach(n),o=u(t),l=m(t,"TD",{class:!0});var c=v(l);O.l(c),c.forEach(n),i=u(t),h=m(t,"TD",{class:!0});var d=v(h);f=T(d,D),d.forEach(n),z=u(t),b=m(t,"TD",{class:!0});var p=v(b);E=T(p,C),p.forEach(n),y=u(t),k=m(t,"TD",{class:!0});var q=v(k);R.l(q),q.forEach(n),x=u(t),t.forEach(n),this.h()},h(){d(a,"class","svelte-8eq6zo"),d(l,"class","svelte-8eq6zo"),d(h,"class","id-cell svelte-8eq6zo"),d(b,"class","svelte-8eq6zo"),d(k,"class","actions-cell svelte-8eq6zo"),d(s,"class","svelte-8eq6zo"),this.first=s},m(e,t){r(e,s,t),c(s,a),U.m(a,null),c(s,o),c(s,l),O.m(l,null),c(s,i),c(s,h),c(h,f),c(s,z),c(s,b),c(b,E),c(s,y),c(s,k),R.m(k,null),c(s,x)},p(e,s){I===(I=N(t=e))&&U?U.p(t,s):(U.d(1),U=I(t),U&&(U.c(),U.m(a,null))),P===(P=H(t))&&O?O.p(t,s):(O.d(1),O=P(t),O&&(O.c(),O.m(l,null))),1&s&&D!==(D=t[21].id+"")&&w(f,D),1&s&&C!==(C=F(t[21].created_at)+"")&&w(E,C),_===(_=S(t))&&R?R.p(t,s):(R.d(1),R=_(t),R&&(R.c(),R.m(k,null)))},d(e){e&&n(s),U.d(),O.d(),R.d()}}}function P(e){let t,s="No moderators found. Add your first moderator above.";return{c(){t=q("div"),t.textContent=s,this.h()},l(e){t=m(e,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-1g10akj"!==f(t)&&(t.textContent=s),this.h()},h(){d(t,"class","empty-state svelte-8eq6zo")},m(e,s){r(e,t,s)},d(e){e&&n(t)}}}function O(e){let t,s,z,w,T,g,b,E,y,k,x,D,C,A,L,M,j,B,V='<h1 class="svelte-8eq6zo">User Management</h1> <a href="/admin" class="svelte-8eq6zo">← Back to Admin Panel</a>',H="Add New Moderator",P="Add Moderator",O=e[2]&&N(e);function F(e,t){return e[1]?U:I}let S=F(e),_=S(e);return{c(){t=p(),s=q("div"),z=q("div"),w=q("div"),w.innerHTML=V,T=p(),O&&O.c(),g=p(),b=q("div"),E=q("h2"),E.textContent=H,y=p(),k=q("div"),x=q("input"),D=p(),C=q("input"),A=p(),L=q("button"),L.textContent=P,M=p(),_.c(),this.h()},l(e){h("svelte-1pmon8",document.head).forEach(n),t=u(e),s=m(e,"DIV",{class:!0});var a=v(s);z=m(a,"DIV",{class:!0});var o=v(z);w=m(o,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-1xvp937"!==f(w)&&(w.innerHTML=V),T=u(o),O&&O.l(o),g=u(o),b=m(o,"DIV",{class:!0});var l=v(b);E=m(l,"H2",{class:!0,"data-svelte-h":!0}),"svelte-u9w48c"!==f(E)&&(E.textContent=H),y=u(l),k=m(l,"DIV",{class:!0});var r=v(k);x=m(r,"INPUT",{placeholder:!0,class:!0}),D=u(r),C=m(r,"INPUT",{type:!0,placeholder:!0,class:!0}),A=u(r),L=m(r,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-dig8n2"!==f(L)&&(L.textContent=P),r.forEach(n),l.forEach(n),M=u(o),_.l(o),o.forEach(n),a.forEach(n),this.h()},h(){document.title="User Management - Placemarked Admin",d(w,"class","admin-header-section svelte-8eq6zo"),d(E,"class","svelte-8eq6zo"),d(x,"placeholder","Enter username"),d(x,"class","svelte-8eq6zo"),d(C,"type","password"),d(C,"placeholder","Enter password"),d(C,"class","svelte-8eq6zo"),d(L,"class","btn btn-primary svelte-8eq6zo"),d(k,"class","add-user-form svelte-8eq6zo"),d(b,"class","add-user-section svelte-8eq6zo"),d(z,"class","admin-content svelte-8eq6zo"),d(s,"class","admin-container svelte-8eq6zo")},m(a,n){r(a,t,n),r(a,s,n),c(s,z),c(z,w),c(z,T),O&&O.m(z,null),c(z,g),c(z,b),c(b,E),c(b,y),c(b,k),c(k,x),l(x,e[3]),c(k,D),c(k,C),l(C,e[4]),c(k,A),c(k,L),c(z,M),_.m(z,null),j||(B=[i(x,"input",e[13]),i(C,"input",e[14]),i(C,"keydown",e[15]),i(L,"click",e[8])],j=!0)},p(e,[t]){e[2]?O?O.p(e,t):(O=N(e),O.c(),O.m(z,g)):O&&(O.d(1),O=null),8&t&&x.value!==e[3]&&l(x,e[3]),16&t&&C.value!==e[4]&&l(C,e[4]),S===(S=F(e))&&_?_.p(e,t):(_.d(1),_=S(e),_&&(_.c(),_.m(z,null)))},i:a,o:a,d(e){e&&(n(t),n(s)),O&&O.d(),_.d(),j=!1,o(B)}}}function F(e){return new Date(e).toLocaleString()}function S(e,t,s){let a=[],n=!0,o="",l="",r="",c=null,i="",d="";async function h(){try{s(1,n=!0),console.log("Loading moderators...");const{data:e,error:t}=await x.from("moderators").select("*").order("created_at",{ascending:!1});if(console.log("Load response:",{data:e,error:t}),t)throw t;s(0,a=e||[])}catch(e){console.error("Error loading moderators:",e),s(2,o=e instanceof Error?e.message:"Failed to load moderators")}finally{s(1,n=!1)}}async function u(){if(l.trim())if(r.trim())try{console.log("Adding moderator:",l.trim());const e=12,t=await D.hash(r.trim(),e),{data:a,error:n}=await x.from("moderators").insert([{username:l.trim(),password:t}]).select();if(console.log("Insert response:",{data:a,error:n}),n)throw n;s(3,l=""),s(4,r=""),await h()}catch(e){console.error("Error adding moderator:",e),s(2,o=e instanceof Error?e.message:"Failed to add moderator")}else s(2,o="Password cannot be empty");else s(2,o="Username cannot be empty")}function m(e){s(5,c=e),s(6,i=e.username||""),s(7,d="")}function v(){s(5,c=null),s(6,i=""),s(7,d="")}async function f(e){if(confirm("Are you sure you want to delete this moderator? This action cannot be undone."))try{const{error:t}=await x.from("moderators").delete().eq("id",e);if(t)throw t;await h()}catch(t){s(2,o=t instanceof Error?t.message:"Failed to delete moderator")}}z(async()=>{await h()});return[a,n,o,l,r,c,i,d,u,m,v,async function(){if(c)try{const e={username:i.trim()};if(d.trim()){const t=12;e.password=await D.hash(d.trim(),t)}const{error:t}=await x.from("moderators").update(e).eq("id",c.id);if(t)throw t;await h(),v()}catch(e){s(2,o=e instanceof Error?e.message:"Failed to update moderator")}},f,function(){l=this.value,s(3,l)},function(){r=this.value,s(4,r)},e=>"Enter"===e.key&&u(),function(){i=this.value,s(6,i)},function(){d=this.value,s(7,d)},e=>m(e),e=>f(e.id)]}class _ extends e{constructor(e){super(),t(this,e,S,O,s,{})}}export{_ as component};
