import{S as t,i as e,s,n,d as l,f as a,h as c,A as i,F as r,m as o,j as d,k as u,B as h,q as p,o as g,y as v,e as f,l as m,p as y,G as j,x as E,C as T,z as b,H as x,I as D,J as w,r as C}from"../chunks/DtDmOkZC.js";import{e as L,u as I,d as N}from"../chunks/DBMzglTz.js";import"../chunks/BzQdJGSh.js";import{s as k}from"../chunks/BskyxVM1.js";function A(t,e,s){const n=t.slice();return n[18]=e[s],n}function M(t,e,s){const n=t.slice();return n[21]=e[s],n}function U(t){let e,s;return{c(){e=g("div"),s=y(t[2]),this.h()},l(n){e=d(n,"DIV",{class:!0});var a=u(e);s=m(a,t[2]),a.forEach(l),this.h()},h(){i(e,"class","error-alert svelte-1gpdjyu")},m(t,n){a(t,e,n),c(e,s)},p(t,e){4&e&&f(s,t[2])},d(t){t&&l(e)}}}function _(t){let e,s,n,r,v,f,m,y='<tr class="svelte-1gpdjyu"><th class="svelte-1gpdjyu">ID</th> <th class="svelte-1gpdjyu">Description</th> <th class="svelte-1gpdjyu">Status</th> <th class="svelte-1gpdjyu">Language</th> <th class="svelte-1gpdjyu">Created</th> <th class="svelte-1gpdjyu">Actions</th></tr>',j=[],T=new Map,b=L(t[0]);const x=t=>t[18].id;for(let l=0;l<b.length;l+=1){let e=A(t,b,l),s=x(e);T.set(s,j[l]=G(s,e))}let D=0===t[0].length&&J();return{c(){e=g("div"),s=g("table"),n=g("thead"),n.innerHTML=y,r=p(),v=g("tbody");for(let t=0;t<j.length;t+=1)j[t].c();f=p(),D&&D.c(),m=E(),this.h()},l(t){e=d(t,"DIV",{class:!0});var a=u(e);s=d(a,"TABLE",{class:!0});var c=u(s);n=d(c,"THEAD",{"data-svelte-h":!0}),"svelte-17d4o1"!==h(n)&&(n.innerHTML=y),r=o(c),v=d(c,"TBODY",{});var i=u(v);for(let e=0;e<j.length;e+=1)j[e].l(i);i.forEach(l),c.forEach(l),a.forEach(l),f=o(t),D&&D.l(t),m=E(),this.h()},h(){i(s,"class","admin-table svelte-1gpdjyu"),i(e,"class","table-container svelte-1gpdjyu")},m(t,l){a(t,e,l),c(e,s),c(s,n),c(s,r),c(s,v);for(let e=0;e<j.length;e+=1)j[e]&&j[e].m(v,null);a(t,f,l),D&&D.m(t,l),a(t,m,l)},p(t,e){4089&e&&(b=L(t[0]),j=I(j,e,x,1,t,b,T,v,N,G,null,A)),0===t[0].length?D||(D=J(),D.c(),D.m(m.parentNode,m)):D&&(D.d(1),D=null)},d(t){t&&(l(e),l(f),l(m));for(let e=0;e<j.length;e+=1)j[e].d();D&&D.d(t)}}}function B(t){let e,s='<div class="loading-spinner svelte-1gpdjyu"></div> <p>Loading moments...</p>';return{c(){e=g("div"),e.innerHTML=s,this.h()},l(t){e=d(t,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-156j5at"!==h(e)&&(e.innerHTML=s),this.h()},h(){i(e,"class","loading-container svelte-1gpdjyu")},m(t,s){a(t,e,s)},p:n,d(t){t&&l(e)}}}function H(t){let e,s,n,r=(t[18].description||"No description")+"";return{c(){e=g("div"),s=y(r),this.h()},l(t){e=d(t,"DIV",{class:!0,title:!0});var n=u(e);s=m(n,r),n.forEach(l),this.h()},h(){i(e,"class","description-text svelte-1gpdjyu"),i(e,"title",n=t[18].description||"")},m(t,n){a(t,e,n),c(e,s)},p(t,l){1&l&&r!==(r=(t[18].description||"No description")+"")&&f(s,r),1&l&&n!==(n=t[18].description||"")&&i(e,"title",n)},d(t){t&&l(e)}}}function V(t){let e,s,n;return{c(){e=g("textarea"),this.h()},l(t){e=d(t,"TEXTAREA",{rows:!0,placeholder:!0,class:!0}),u(e).forEach(l),this.h()},h(){i(e,"rows","3"),i(e,"placeholder","Enter description..."),i(e,"class","svelte-1gpdjyu")},m(l,c){a(l,e,c),T(e,t[4]),s||(n=b(e,"input",t[12]),s=!0)},p(t,s){16&s&&T(e,t[4])},d(t){t&&l(e),s=!1,n()}}}function O(t){let e,s,n,r=(t[18].status||"pending")+"";return{c(){e=g("span"),s=y(r),this.h()},l(t){e=d(t,"SPAN",{class:!0});var n=u(e);s=m(n,r),n.forEach(l),this.h()},h(){i(e,"class",n="status-badge status-"+(t[18].status||"pending")+" svelte-1gpdjyu")},m(t,n){a(t,e,n),c(e,s)},p(t,l){1&l&&r!==(r=(t[18].status||"pending")+"")&&f(s,r),1&l&&n!==(n="status-badge status-"+(t[18].status||"pending")+" svelte-1gpdjyu")&&i(e,"class",n)},d(t){t&&l(e)}}}function S(t){let e,s,n,c=L(t[7]),r=[];for(let l=0;l<c.length;l+=1)r[l]=z(M(t,c,l));return{c(){e=g("select");for(let t=0;t<r.length;t+=1)r[t].c();this.h()},l(t){e=d(t,"SELECT",{class:!0});var s=u(e);for(let e=0;e<r.length;e+=1)r[e].l(s);s.forEach(l),this.h()},h(){i(e,"class","svelte-1gpdjyu"),void 0===t[5]&&w(()=>t[13].call(e))},m(l,c){a(l,e,c);for(let t=0;t<r.length;t+=1)r[t]&&r[t].m(e,null);D(e,t[5],!0),s||(n=b(e,"change",t[13]),s=!0)},p(t,s){if(128&s){let n;for(c=L(t[7]),n=0;n<c.length;n+=1){const l=M(t,c,n);r[n]?r[n].p(l,s):(r[n]=z(l),r[n].c(),r[n].m(e,null))}for(;n<r.length;n+=1)r[n].d(1);r.length=c.length}160&s&&D(e,t[5])},d(t){t&&l(e),x(r,t),s=!1,n()}}}function z(t){let e,s,i=t[21]+"";return{c(){e=g("option"),s=y(i),this.h()},l(t){e=d(t,"OPTION",{});var n=u(e);s=m(n,i),n.forEach(l),this.h()},h(){e.__value=t[21],T(e,e.__value)},m(t,n){a(t,e,n),c(e,s)},p:n,d(t){t&&l(e)}}}function F(t){let e,s=(t[18].language||"Not specified")+"";return{c(){e=y(s)},l(t){e=m(t,s)},m(t,s){a(t,e,s)},p(t,n){1&n&&s!==(s=(t[18].language||"Not specified")+"")&&f(e,s)},d(t){t&&l(e)}}}function P(t){let e,s,n;return{c(){e=g("input"),this.h()},l(t){e=d(t,"INPUT",{placeholder:!0,class:!0}),this.h()},h(){i(e,"placeholder","Language code (e.g., en, es)"),i(e,"class","svelte-1gpdjyu")},m(l,c){a(l,e,c),T(e,t[6]),s||(n=b(e,"input",t[14]),s=!0)},p(t,s){64&s&&e.value!==t[6]&&T(e,t[6])},d(t){t&&l(e),s=!1,n()}}}function q(t){let e,s,n,c,r,u="Edit",v="Delete";function f(){return t[15](t[18])}function m(){return t[16](t[18])}return{c(){e=g("button"),e.textContent=u,s=p(),n=g("button"),n.textContent=v,this.h()},l(t){e=d(t,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-1s101mr"!==h(e)&&(e.textContent=u),s=o(t),n=d(t,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-1t2s9zv"!==h(n)&&(n.textContent=v),this.h()},h(){i(e,"class","btn btn-edit svelte-1gpdjyu"),i(n,"class","btn btn-delete svelte-1gpdjyu")},m(t,l){a(t,e,l),a(t,s,l),a(t,n,l),c||(r=[b(e,"click",f),b(n,"click",m)],c=!0)},p(e,s){t=e},d(t){t&&(l(e),l(s),l(n)),c=!1,C(r)}}}function R(t){let e,s,c,r,u,v="Save",f="Cancel";return{c(){e=g("button"),e.textContent=v,s=p(),c=g("button"),c.textContent=f,this.h()},l(t){e=d(t,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-1txxts7"!==h(e)&&(e.textContent=v),s=o(t),c=d(t,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-gi3vpc"!==h(c)&&(c.textContent=f),this.h()},h(){i(e,"class","btn btn-save svelte-1gpdjyu"),i(c,"class","btn btn-cancel svelte-1gpdjyu")},m(n,l){a(n,e,l),a(n,s,l),a(n,c,l),r||(u=[b(e,"click",t[10]),b(c,"click",t[9])],r=!0)},p:n,d(t){t&&(l(e),l(s),l(c)),r=!1,C(u)}}}function G(t,e){let s,n,r,h,v,j,E,T,b,x,D,w,C,L,I,N=e[18].short_id+"",k=Q(e[18].created_at)+"";function A(t,e){return t[3]?.id===t[18].id?V:H}let M=A(e),U=M(e);function _(t,e){return t[3]?.id===t[18].id?S:O}let B=_(e),z=B(e);function G(t,e){return t[3]?.id===t[18].id?P:F}let J=G(e),K=J(e);function X(t,e){return t[3]?.id===t[18].id?R:q}let Y=X(e),$=Y(e);return{key:t,first:null,c(){s=g("tr"),n=g("td"),r=y(N),h=p(),v=g("td"),U.c(),j=p(),E=g("td"),z.c(),T=p(),b=g("td"),K.c(),x=p(),D=g("td"),w=y(k),C=p(),L=g("td"),$.c(),I=p(),this.h()},l(t){s=d(t,"TR",{class:!0});var e=u(s);n=d(e,"TD",{class:!0});var a=u(n);r=m(a,N),a.forEach(l),h=o(e),v=d(e,"TD",{class:!0});var c=u(v);U.l(c),c.forEach(l),j=o(e),E=d(e,"TD",{class:!0});var i=u(E);z.l(i),i.forEach(l),T=o(e),b=d(e,"TD",{class:!0});var p=u(b);K.l(p),p.forEach(l),x=o(e),D=d(e,"TD",{class:!0});var g=u(D);w=m(g,k),g.forEach(l),C=o(e),L=d(e,"TD",{class:!0});var f=u(L);$.l(f),f.forEach(l),I=o(e),e.forEach(l),this.h()},h(){i(n,"class","svelte-1gpdjyu"),i(v,"class","description-cell svelte-1gpdjyu"),i(E,"class","svelte-1gpdjyu"),i(b,"class","svelte-1gpdjyu"),i(D,"class","svelte-1gpdjyu"),i(L,"class","actions-cell svelte-1gpdjyu"),i(s,"class","svelte-1gpdjyu"),this.first=s},m(t,e){a(t,s,e),c(s,n),c(n,r),c(s,h),c(s,v),U.m(v,null),c(s,j),c(s,E),z.m(E,null),c(s,T),c(s,b),K.m(b,null),c(s,x),c(s,D),c(D,w),c(s,C),c(s,L),$.m(L,null),c(s,I)},p(t,s){e=t,1&s&&N!==(N=e[18].short_id+"")&&f(r,N),M===(M=A(e))&&U?U.p(e,s):(U.d(1),U=M(e),U&&(U.c(),U.m(v,null))),B===(B=_(e))&&z?z.p(e,s):(z.d(1),z=B(e),z&&(z.c(),z.m(E,null))),J===(J=G(e))&&K?K.p(e,s):(K.d(1),K=J(e),K&&(K.c(),K.m(b,null))),1&s&&k!==(k=Q(e[18].created_at)+"")&&f(w,k),Y===(Y=X(e))&&$?$.p(e,s):($.d(1),$=Y(e),$&&($.c(),$.m(L,null)))},d(t){t&&l(s),U.d(),z.d(),K.d(),$.d()}}}function J(t){let e,s="No moments found in the database.";return{c(){e=g("div"),e.textContent=s,this.h()},l(t){e=d(t,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-bzn18h"!==h(e)&&(e.textContent=s),this.h()},h(){i(e,"class","empty-state svelte-1gpdjyu")},m(t,s){a(t,e,s)},d(t){t&&l(e)}}}function K(t){let e,s,v,f,m,y,j='<h1 class="svelte-1gpdjyu">Admin Panel</h1> <div class="admin-links svelte-1gpdjyu"><a href="/admin/users" class="svelte-1gpdjyu">Manage Users</a> <a href="/" class="svelte-1gpdjyu">‚Üê Back to Map</a></div>',E=t[2]&&U(t);function T(t,e){return t[1]?B:_}let b=T(t),x=b(t);return{c(){e=p(),s=g("div"),v=g("div"),f=g("div"),f.innerHTML=j,m=p(),E&&E.c(),y=p(),x.c(),this.h()},l(t){r("svelte-1o7e32t",document.head).forEach(l),e=o(t),s=d(t,"DIV",{class:!0});var n=u(s);v=d(n,"DIV",{class:!0});var a=u(v);f=d(a,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-zs3xhw"!==h(f)&&(f.innerHTML=j),m=o(a),E&&E.l(a),y=o(a),x.l(a),a.forEach(l),n.forEach(l),this.h()},h(){document.title="Admin - UK Queering Map",i(f,"class","admin-header-section svelte-1gpdjyu"),i(v,"class","admin-content svelte-1gpdjyu"),i(s,"class","admin-container svelte-1gpdjyu")},m(t,n){a(t,e,n),a(t,s,n),c(s,v),c(v,f),c(v,m),E&&E.m(v,null),c(v,y),x.m(v,null)},p(t,[e]){t[2]?E?E.p(t,e):(E=U(t),E.c(),E.m(v,y)):E&&(E.d(1),E=null),b===(b=T(t))&&x?x.p(t,e):(x.d(1),x=b(t),x&&(x.c(),x.m(v,null)))},i:n,o:n,d(t){t&&(l(e),l(s)),E&&E.d(),x.d()}}}function Q(t){return new Date(t).toLocaleString()}function X(t,e,s){let n=[],l=!0,a="",c=null,i="",r="",o="";const d=["pending","approved","rejected"];function u(t){s(3,c=t),s(4,i=t.description||""),s(5,r=t.status||"pending"),s(6,o=t.language||"")}function h(){s(3,c=null),s(4,i=""),s(5,r=""),s(6,o="")}async function p(t){if(confirm("Are you sure you want to delete this moment? This action cannot be undone."))try{const{error:e}=await k.from("moments").delete().eq("id",t);if(e)throw e;s(0,n=n.filter(e=>e.id!==t))}catch(e){s(2,a=e instanceof Error?e.message:"Failed to delete moment")}}v(async()=>{await async function(){try{s(1,l=!0);const{data:t,error:e}=await k.from("moments").select("*").order("created_at",{ascending:!1});if(e)throw e;s(0,n=t||[])}catch(t){s(2,a=t instanceof Error?t.message:"Failed to load moments")}finally{s(1,l=!1)}}()});return[n,l,a,c,i,r,o,d,u,h,async function(){if(!c)return;let t=o;if(o&&""!==o.trim()){if(t=o.toLowerCase().trim(),!/^[a-z]{2}$/.test(t))return void s(2,a='Language must be exactly 2 lowercase letters (e.g., "en", "es")')}else t=null;try{console.log("Updating moment:",c.id),console.log("Update data:",{description:i,status:r,language:t});const e={description:i,status:r};null!==t&&(e.language=t);const{data:l,error:a}=await k.from("moments").update(e).eq("id",c.id).select();if(console.log("Update response:",{data:l,error:a}),a)throw a;const d=n.findIndex(t=>t.id===c.id);-1!==d&&s(0,n[d]={...n[d],description:i,status:r,language:o},n),h()}catch(e){s(2,a=e instanceof Error?e.message:"Failed to update moment")}},p,function(){i=this.value,s(4,i)},function(){r=j(this),s(5,r),s(7,d)},function(){o=this.value,s(6,o)},t=>u(t),t=>p(t.id)]}class Y extends t{constructor(t){super(),e(this,t,X,K,s,{})}}export{Y as component};
