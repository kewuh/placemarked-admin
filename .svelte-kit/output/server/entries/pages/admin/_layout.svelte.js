import{c as n,d as e}from"../../../chunks/ssr.js";import"@sveltejs/kit/internal";import"../../../chunks/exports.js";import"../../../chunks/utils.js";import"../../../chunks/state.svelte.js";import"../../../chunks/supabaseClient.js";import"bcryptjs";const A={code:".admin-layout.svelte-12inje5.svelte-12inje5{min-height:100vh;background-color:#f5f5f5}.admin-header.svelte-12inje5.svelte-12inje5{background:white;border-bottom:1px solid #eee;box-shadow:0 2px 4px rgba(0,0,0,0.1)}.admin-header-content.svelte-12inje5.svelte-12inje5{max-width:1200px;margin:0 auto;padding:15px 20px;display:flex;justify-content:space-between;align-items:center}.admin-header-content.svelte-12inje5 h1.svelte-12inje5{margin:0;font-size:20px;font-weight:600;color:#333}.admin-nav.svelte-12inje5.svelte-12inje5{display:flex;gap:15px;align-items:center}.admin-nav.svelte-12inje5 a.svelte-12inje5{color:#0066cc;text-decoration:none;font-size:14px}.admin-nav.svelte-12inje5 a.svelte-12inje5:hover{text-decoration:underline}.admin-nav.svelte-12inje5 button.svelte-12inje5{background:none;border:none;color:#dc3545;cursor:pointer;font-size:14px;padding:0}.admin-nav.svelte-12inje5 button.svelte-12inje5:hover{text-decoration:underline}.login-container.svelte-12inje5.svelte-12inje5{min-height:100vh;background-color:#f5f5f5;display:flex;align-items:center;justify-content:center;padding:20px}.login-form.svelte-12inje5.svelte-12inje5{background:white;padding:40px;border-radius:8px;box-shadow:0 4px 6px rgba(0,0,0,0.1);width:100%;max-width:400px}.login-header.svelte-12inje5.svelte-12inje5{text-align:center;margin-bottom:30px}.login-header.svelte-12inje5 h2.svelte-12inje5{margin:0 0 10px 0;font-size:28px;font-weight:bold;color:#333}.login-header.svelte-12inje5 p.svelte-12inje5{margin:0;color:#666;font-size:14px}.form-group.svelte-12inje5.svelte-12inje5{margin-bottom:20px}.form-group.svelte-12inje5 label.svelte-12inje5{display:block;margin-bottom:5px;font-weight:500;color:#333}.form-group.svelte-12inje5 input.svelte-12inje5{width:100%;padding:12px;border:1px solid #ddd;border-radius:4px;font-size:16px;box-sizing:border-box}.form-group.svelte-12inje5 input.svelte-12inje5:focus{outline:none;border-color:#0066cc;box-shadow:0 0 0 2px rgba(0,102,204,0.2)}.error-message.svelte-12inje5.svelte-12inje5{color:#dc3545;font-size:14px;text-align:center;margin-bottom:20px}.login-form.svelte-12inje5 button.svelte-12inje5{width:100%;padding:12px;background-color:#0066cc;color:white;border:none;border-radius:4px;font-size:16px;font-weight:500;cursor:pointer}.login-form.svelte-12inje5 button.svelte-12inje5:hover{background-color:#0052a3}.login-footer.svelte-12inje5.svelte-12inje5{text-align:center;margin-top:20px}.login-footer.svelte-12inje5 a.svelte-12inje5{color:#0066cc;text-decoration:none;font-size:14px}.login-footer.svelte-12inje5 a.svelte-12inje5:hover{text-decoration:underline}",map:'{"version":3,"file":"+layout.svelte","sources":["+layout.svelte"],"sourcesContent":["<script lang=\\"ts\\">import { onMount } from \\"svelte\\";\\nimport { page } from \\"$app/stores\\";\\nimport { supabase } from \\"$lib/clients/supabaseClient\\";\\nimport bcrypt from \\"bcryptjs\\";\\nlet isAuthenticated = false;\\nlet username = \\"\\";\\nlet password = \\"\\";\\nlet error = \\"\\";\\nlet loginAttempts = 0;\\nlet isLocked = false;\\nlet lockoutTime = 0;\\nconst MAX_LOGIN_ATTEMPTS = 5;\\nconst LOCKOUT_DURATION = 15 * 60 * 1e3;\\nconst SESSION_TIMEOUT = 8 * 60 * 60 * 1e3;\\nonMount(() => {\\n  if (typeof window === \\"undefined\\") return;\\n  const auth = sessionStorage.getItem(\\"admin_authenticated\\");\\n  const loginTime = sessionStorage.getItem(\\"admin_login_time\\");\\n  if (auth === \\"true\\" && loginTime) {\\n    const timeSinceLogin = Date.now() - parseInt(loginTime);\\n    if (timeSinceLogin < SESSION_TIMEOUT) {\\n      isAuthenticated = true;\\n    } else {\\n      handleLogout();\\n    }\\n  }\\n  const lockoutUntil = sessionStorage.getItem(\\"admin_lockout_until\\");\\n  if (lockoutUntil) {\\n    const currentLockoutTime = parseInt(lockoutUntil);\\n    if (Date.now() < currentLockoutTime) {\\n      isLocked = true;\\n      lockoutTime = currentLockoutTime;\\n    } else {\\n      sessionStorage.removeItem(\\"admin_lockout_until\\");\\n      sessionStorage.removeItem(\\"admin_login_attempts\\");\\n    }\\n  }\\n  const attempts = sessionStorage.getItem(\\"admin_login_attempts\\");\\n  if (attempts) {\\n    loginAttempts = parseInt(attempts);\\n  }\\n});\\nasync function handleLogin() {\\n  if (isLocked) {\\n    const remainingTime = Math.ceil((lockoutTime - Date.now()) / 1e3 / 60);\\n    error = `Account locked. Try again in ${remainingTime} minutes.`;\\n    return;\\n  }\\n  if (!username.trim() || !password.trim()) {\\n    error = \\"Please enter both username and password\\";\\n    return;\\n  }\\n  try {\\n    const { data, error: loginError } = await supabase.from(\\"moderators\\").select(\\"id, username, password\\").eq(\\"username\\", username.trim()).single();\\n    if (loginError || !data) {\\n      handleFailedLogin();\\n      error = \\"Invalid username or password\\";\\n      return;\\n    }\\n    const passwordMatch = await bcrypt.compare(password.trim(), data.password || \\"\\");\\n    if (passwordMatch) {\\n      isAuthenticated = true;\\n      if (typeof window !== \\"undefined\\") {\\n        sessionStorage.setItem(\\"admin_authenticated\\", \\"true\\");\\n        sessionStorage.setItem(\\"admin_username\\", data.username || \\"\\");\\n        sessionStorage.setItem(\\"admin_login_time\\", Date.now().toString());\\n        sessionStorage.removeItem(\\"admin_login_attempts\\");\\n        sessionStorage.removeItem(\\"admin_lockout_until\\");\\n      }\\n      loginAttempts = 0;\\n      isLocked = false;\\n      error = \\"\\";\\n    } else {\\n      handleFailedLogin();\\n      error = \\"Invalid username or password\\";\\n    }\\n  } catch (err) {\\n    handleFailedLogin();\\n    error = \\"Login failed. Please try again.\\";\\n  }\\n}\\nfunction handleFailedLogin() {\\n  loginAttempts++;\\n  if (typeof window !== \\"undefined\\") {\\n    sessionStorage.setItem(\\"admin_login_attempts\\", loginAttempts.toString());\\n  }\\n  if (loginAttempts >= MAX_LOGIN_ATTEMPTS) {\\n    isLocked = true;\\n    lockoutTime = Date.now() + LOCKOUT_DURATION;\\n    if (typeof window !== \\"undefined\\") {\\n      sessionStorage.setItem(\\"admin_lockout_until\\", lockoutTime.toString());\\n    }\\n    error = `Too many failed attempts. Account locked for 15 minutes.`;\\n  }\\n}\\nfunction handleLogout() {\\n  isAuthenticated = false;\\n  if (typeof window !== \\"undefined\\") {\\n    sessionStorage.removeItem(\\"admin_authenticated\\");\\n    sessionStorage.removeItem(\\"admin_username\\");\\n    sessionStorage.removeItem(\\"admin_login_time\\");\\n  }\\n  username = \\"\\";\\n  password = \\"\\";\\n}\\nlet inactivityTimer;\\nfunction resetInactivityTimer() {\\n  if (inactivityTimer) clearTimeout(inactivityTimer);\\n  if (isAuthenticated) {\\n    inactivityTimer = setTimeout(() => {\\n      handleLogout();\\n    }, 30 * 60 * 1e3);\\n  }\\n}\\nfunction handleUserActivity() {\\n  resetInactivityTimer();\\n}\\n$: if (isAuthenticated && typeof document !== \\"undefined\\") {\\n  resetInactivityTimer();\\n  document.addEventListener(\\"mousemove\\", handleUserActivity);\\n  document.addEventListener(\\"keypress\\", handleUserActivity);\\n  document.addEventListener(\\"click\\", handleUserActivity);\\n} else if (typeof document !== \\"undefined\\") {\\n  if (inactivityTimer) clearTimeout(inactivityTimer);\\n  document.removeEventListener(\\"mousemove\\", handleUserActivity);\\n  document.removeEventListener(\\"keypress\\", handleUserActivity);\\n  document.removeEventListener(\\"click\\", handleUserActivity);\\n}\\n<\/script>\\n\\n{#if isAuthenticated}\\n  <div class=\\"admin-layout\\">\\n    <div class=\\"admin-header\\">\\n      <div class=\\"admin-header-content\\">\\n        <h1>UK Queering Map - Admin</h1>\\n        <div class=\\"admin-nav\\">\\n          <a href=\\"/\\">View Map</a>\\n          <button on:click={handleLogout}>Logout</button>\\n        </div>\\n      </div>\\n    </div>\\n    <slot />\\n  </div>\\n{:else}\\n  <div class=\\"login-container\\">\\n    <div class=\\"login-form\\">\\n      <div class=\\"login-header\\">\\n        <h2>Admin Access</h2>\\n        <p>Enter the admin password to continue</p>\\n      </div>\\n      <form on:submit|preventDefault={handleLogin}>\\n        <div class=\\"form-group\\">\\n          <label for=\\"username\\">Username</label>\\n          <input\\n            id=\\"username\\"\\n            bind:value={username}\\n            type=\\"text\\"\\n            required\\n            placeholder=\\"Enter username\\"\\n          />\\n        </div>\\n        <div class=\\"form-group\\">\\n          <label for=\\"password\\">Password</label>\\n          <input\\n            id=\\"password\\"\\n            bind:value={password}\\n            type=\\"password\\"\\n            required\\n            placeholder=\\"Enter password\\"\\n          />\\n        </div>\\n        \\n        {#if error}\\n          <div class=\\"error-message\\">\\n            {error}\\n          </div>\\n        {/if}\\n        \\n        <button type=\\"submit\\">Sign in</button>\\n      </form>\\n      \\n      <div class=\\"login-footer\\">\\n        <a href=\\"/\\">← Back to Map</a>\\n      </div>\\n    </div>\\n  </div>\\n{/if}\\n\\n<style>\\n  .admin-layout {\\n    min-height: 100vh;\\n    background-color: #f5f5f5;\\n  }\\n\\n  .admin-header {\\n    background: white;\\n    border-bottom: 1px solid #eee;\\n    box-shadow: 0 2px 4px rgba(0,0,0,0.1);\\n  }\\n\\n  .admin-header-content {\\n    max-width: 1200px;\\n    margin: 0 auto;\\n    padding: 15px 20px;\\n    display: flex;\\n    justify-content: space-between;\\n    align-items: center;\\n  }\\n\\n  .admin-header-content h1 {\\n    margin: 0;\\n    font-size: 20px;\\n    font-weight: 600;\\n    color: #333;\\n  }\\n\\n  .admin-nav {\\n    display: flex;\\n    gap: 15px;\\n    align-items: center;\\n  }\\n\\n  .admin-nav a {\\n    color: #0066cc;\\n    text-decoration: none;\\n    font-size: 14px;\\n  }\\n\\n  .admin-nav a:hover {\\n    text-decoration: underline;\\n  }\\n\\n  .admin-nav button {\\n    background: none;\\n    border: none;\\n    color: #dc3545;\\n    cursor: pointer;\\n    font-size: 14px;\\n    padding: 0;\\n  }\\n\\n  .admin-nav button:hover {\\n    text-decoration: underline;\\n  }\\n\\n  .login-container {\\n    min-height: 100vh;\\n    background-color: #f5f5f5;\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n    padding: 20px;\\n  }\\n\\n  .login-form {\\n    background: white;\\n    padding: 40px;\\n    border-radius: 8px;\\n    box-shadow: 0 4px 6px rgba(0,0,0,0.1);\\n    width: 100%;\\n    max-width: 400px;\\n  }\\n\\n  .login-header {\\n    text-align: center;\\n    margin-bottom: 30px;\\n  }\\n\\n  .login-header h2 {\\n    margin: 0 0 10px 0;\\n    font-size: 28px;\\n    font-weight: bold;\\n    color: #333;\\n  }\\n\\n  .login-header p {\\n    margin: 0;\\n    color: #666;\\n    font-size: 14px;\\n  }\\n\\n  .form-group {\\n    margin-bottom: 20px;\\n  }\\n\\n  .form-group label {\\n    display: block;\\n    margin-bottom: 5px;\\n    font-weight: 500;\\n    color: #333;\\n  }\\n\\n  .form-group input {\\n    width: 100%;\\n    padding: 12px;\\n    border: 1px solid #ddd;\\n    border-radius: 4px;\\n    font-size: 16px;\\n    box-sizing: border-box;\\n  }\\n\\n  .form-group input:focus {\\n    outline: none;\\n    border-color: #0066cc;\\n    box-shadow: 0 0 0 2px rgba(0,102,204,0.2);\\n  }\\n\\n  .error-message {\\n    color: #dc3545;\\n    font-size: 14px;\\n    text-align: center;\\n    margin-bottom: 20px;\\n  }\\n\\n  .login-form button {\\n    width: 100%;\\n    padding: 12px;\\n    background-color: #0066cc;\\n    color: white;\\n    border: none;\\n    border-radius: 4px;\\n    font-size: 16px;\\n    font-weight: 500;\\n    cursor: pointer;\\n  }\\n\\n  .login-form button:hover {\\n    background-color: #0052a3;\\n  }\\n\\n  .login-footer {\\n    text-align: center;\\n    margin-top: 20px;\\n  }\\n\\n  .login-footer a {\\n    color: #0066cc;\\n    text-decoration: none;\\n    font-size: 14px;\\n  }\\n\\n  .login-footer a:hover {\\n    text-decoration: underline;\\n  }\\n</style>\\n// Force redeploy for title fix\\n// Force cache clear\\n"],"names":[],"mappings":"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"}'},t=n((n,t,o,i)=>{function r(){}return n.css.add(A),"undefined"!=typeof document&&(document.removeEventListener("mousemove",r),document.removeEventListener("keypress",r),document.removeEventListener("click",r)),`<div class="login-container svelte-12inje5"><div class="login-form svelte-12inje5"><div class="login-header svelte-12inje5" data-svelte-h="svelte-1utotrw"><h2 class="svelte-12inje5">Admin Access</h2> <p class="svelte-12inje5">Enter the admin password to continue</p></div> <form><div class="form-group svelte-12inje5"><label for="username" class="svelte-12inje5" data-svelte-h="svelte-1wr0xay">Username</label> <input id="username" type="text" required placeholder="Enter username" class="svelte-12inje5"${e("value","")}></div> <div class="form-group svelte-12inje5"><label for="password" class="svelte-12inje5" data-svelte-h="svelte-pepa0a">Password</label> <input id="password" type="password" required placeholder="Enter password" class="svelte-12inje5"${e("value","")}></div>  <button type="submit" class="svelte-12inje5" data-svelte-h="svelte-13remx3">Sign in</button></form> <div class="login-footer svelte-12inje5" data-svelte-h="svelte-17relh6"><a href="/" class="svelte-12inje5">← Back to Map</a></div></div></div> \n// Force redeploy for title fix\n// Force cache clear`});export{t as default};
