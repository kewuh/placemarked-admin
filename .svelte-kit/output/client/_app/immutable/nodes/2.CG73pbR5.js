import{S as e,i as t,s,d as n,t as a,a as o,w as i,f as r,l,p as c,x as d,c as m,u,g as v,b as p,h as f,y as h,z as g,j as w,k as I,A as j,m as y,o as _,q as S,n as E,r as x,B as k,C as D,e as T,D as L}from"../chunks/Q9p8_eM0.js";import"../chunks/BzQdJGSh.js";import"../chunks/D7YgKBWV.js";import{s as $}from"../chunks/BskyxVM1.js";import{b as C}from"../chunks/UorctoEd.js";function V(e){let t,s,a,o,i,l,c,d,m,u,v,p,T,L,$,C,V,A,M,B,F,q='<h2 class="svelte-12inje5">Admin Access</h2> <p class="svelte-12inje5">Enter the admin password to continue</p>',U="Username",H="Password",N="Sign in",P='<a href="/" class="svelte-12inje5">‚Üê Back to Map</a>',O=e[3]&&b(e);return{c(){t=_("div"),s=_("div"),a=_("div"),a.innerHTML=q,o=S(),i=_("form"),l=_("div"),c=_("label"),c.textContent=U,d=S(),m=_("input"),u=S(),v=_("div"),p=_("label"),p.textContent=H,T=S(),L=_("input"),$=S(),O&&O.c(),C=S(),V=_("button"),V.textContent=N,A=S(),M=_("div"),M.innerHTML=P,this.h()},l(e){t=w(e,"DIV",{class:!0});var r=I(t);s=w(r,"DIV",{class:!0});var f=I(s);a=w(f,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-1utotrw"!==j(a)&&(a.innerHTML=q),o=y(f),i=w(f,"FORM",{});var h=I(i);l=w(h,"DIV",{class:!0});var g=I(l);c=w(g,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),"svelte-1wr0xay"!==j(c)&&(c.textContent=U),d=y(g),m=w(g,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),g.forEach(n),u=y(h),v=w(h,"DIV",{class:!0});var _=I(v);p=w(_,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),"svelte-pepa0a"!==j(p)&&(p.textContent=H),T=y(_),L=w(_,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),_.forEach(n),$=y(h),O&&O.l(h),C=y(h),V=w(h,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),"svelte-13remx3"!==j(V)&&(V.textContent=N),h.forEach(n),A=y(f),M=w(f,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-17relh6"!==j(M)&&(M.innerHTML=P),f.forEach(n),r.forEach(n),this.h()},h(){g(a,"class","login-header svelte-12inje5"),g(c,"for","username"),g(c,"class","svelte-12inje5"),g(m,"id","username"),g(m,"type","text"),m.required=!0,g(m,"placeholder","Enter username"),g(m,"class","svelte-12inje5"),g(l,"class","form-group svelte-12inje5"),g(p,"for","password"),g(p,"class","svelte-12inje5"),g(L,"id","password"),g(L,"type","password"),L.required=!0,g(L,"placeholder","Enter password"),g(L,"class","svelte-12inje5"),g(v,"class","form-group svelte-12inje5"),g(V,"type","submit"),g(V,"class","svelte-12inje5"),g(M,"class","login-footer svelte-12inje5"),g(s,"class","login-form svelte-12inje5"),g(t,"class","login-container svelte-12inje5")},m(n,g){r(n,t,g),f(t,s),f(s,a),f(s,o),f(s,i),f(i,l),f(l,c),f(l,d),f(l,m),k(m,e[1]),f(i,u),f(i,v),f(v,p),f(v,T),f(v,L),k(L,e[2]),f(i,$),O&&O.m(i,null),f(i,C),f(i,V),f(s,A),f(s,M),B||(F=[h(m,"input",e[9]),h(L,"input",e[10]),h(i,"submit",D(e[4]))],B=!0)},p(e,t){2&t&&m.value!==e[1]&&k(m,e[1]),4&t&&L.value!==e[2]&&k(L,e[2]),e[3]?O?O.p(e,t):(O=b(e),O.c(),O.m(i,C)):O&&(O.d(1),O=null)},i:E,o:E,d(e){e&&n(t),O&&O.d(),B=!1,x(F)}}}function A(e){let t,s,i,l,c,d,E,x,k,D,T,L,$,C="UK Queering Map - Admin",V="View Map",A="Logout";const b=e[8].default,M=m(b,e,e[7],null);return{c(){t=_("div"),s=_("div"),i=_("div"),l=_("h1"),l.textContent=C,c=S(),d=_("div"),E=_("a"),E.textContent=V,x=S(),k=_("button"),k.textContent=A,D=S(),M&&M.c(),this.h()},l(e){t=w(e,"DIV",{class:!0});var a=I(t);s=w(a,"DIV",{class:!0});var o=I(s);i=w(o,"DIV",{class:!0});var r=I(i);l=w(r,"H1",{class:!0,"data-svelte-h":!0}),"svelte-1rl2irq"!==j(l)&&(l.textContent=C),c=y(r),d=w(r,"DIV",{class:!0});var m=I(d);E=w(m,"A",{href:!0,class:!0,"data-svelte-h":!0}),"svelte-16qhefg"!==j(E)&&(E.textContent=V),x=y(m),k=w(m,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-18t49m"!==j(k)&&(k.textContent=A),m.forEach(n),r.forEach(n),o.forEach(n),D=y(a),M&&M.l(a),a.forEach(n),this.h()},h(){g(l,"class","svelte-12inje5"),g(E,"href","/"),g(E,"class","svelte-12inje5"),g(k,"class","svelte-12inje5"),g(d,"class","admin-nav svelte-12inje5"),g(i,"class","admin-header-content svelte-12inje5"),g(s,"class","admin-header svelte-12inje5"),g(t,"class","admin-layout svelte-12inje5")},m(n,a){r(n,t,a),f(t,s),f(s,i),f(i,l),f(i,c),f(i,d),f(d,E),f(d,x),f(d,k),f(t,D),M&&M.m(t,null),T=!0,L||($=h(k,"click",e[5]),L=!0)},p(e,t){M&&M.p&&(!T||128&t)&&u(M,b,e,e[7],T?p(b,e[7],t,null):v(e[7]),null)},i(e){T||(o(M,e),T=!0)},o(e){a(M,e),T=!1},d(e){e&&n(t),M&&M.d(e),L=!1,$()}}}function b(e){let t,s;return{c(){t=_("div"),s=c(e[3]),this.h()},l(a){t=w(a,"DIV",{class:!0});var o=I(t);s=l(o,e[3]),o.forEach(n),this.h()},h(){g(t,"class","error-message svelte-12inje5")},m(e,n){r(e,t,n),f(t,s)},p(e,t){8&t&&T(s,e[3])},d(e){e&&n(t)}}}function M(e){let t,s,d,m;const u=[A,V],v=[];function p(e,t){return e[0]?0:1}return t=p(e),s=v[t]=u[t](e),{c(){s.c(),d=c("\n\n\n// Force redeploy for title fix\n// Force cache clear\n// Force new deployment Wed Aug 27 16:57:34 BST 2025")},l(e){s.l(e),d=l(e,"\n\n\n// Force redeploy for title fix\n// Force cache clear\n// Force new deployment Wed Aug 27 16:57:34 BST 2025")},m(e,s){v[t].m(e,s),r(e,d,s),m=!0},p(e,[n]){let r=t;t=p(e),t===r?v[t].p(e,n):(L(),a(v[r],1,1,()=>{v[r]=null}),i(),s=v[t],s?s.p(e,n):(s=v[t]=u[t](e),s.c()),o(s,1),s.m(d.parentNode,d))},i(e){m||(o(s),m=!0)},o(e){a(s),m=!1},d(e){e&&n(d),v[t].d(e)}}}function B(e,t,s){let{$$slots:n={},$$scope:a}=t,o=!1,i="",r="",l="",c=0,m=!1,u=0;function v(){c++,"undefined"!=typeof window&&sessionStorage.setItem("admin_login_attempts",c.toString()),c>=5&&(m=!0,u=Date.now()+9e5,"undefined"!=typeof window&&sessionStorage.setItem("admin_lockout_until",u.toString()),s(3,l="Too many failed attempts. Account locked for 15 minutes."))}function p(){s(0,o=!1),"undefined"!=typeof window&&(sessionStorage.removeItem("admin_authenticated"),sessionStorage.removeItem("admin_username"),sessionStorage.removeItem("admin_login_time")),s(1,i=""),s(2,r="")}let f;function h(){f&&clearTimeout(f),o&&s(6,f=setTimeout(()=>{p()},18e5))}function g(){h()}return d(()=>{if("undefined"==typeof window)return;const e=sessionStorage.getItem("admin_authenticated"),t=sessionStorage.getItem("admin_login_time");if("true"===e&&t){Date.now()-parseInt(t)<288e5?s(0,o=!0):p()}const n=sessionStorage.getItem("admin_lockout_until");if(n){const e=parseInt(n);Date.now()<e?(m=!0,u=e):(sessionStorage.removeItem("admin_lockout_until"),sessionStorage.removeItem("admin_login_attempts"))}const a=sessionStorage.getItem("admin_login_attempts");a&&(c=parseInt(a))}),e.$$set=e=>{"$$scope"in e&&s(7,a=e.$$scope)},e.$$.update=()=>{65&e.$$.dirty&&(o&&"undefined"!=typeof document?(h(),document.addEventListener("mousemove",g),document.addEventListener("keypress",g),document.addEventListener("click",g)):"undefined"!=typeof document&&(f&&clearTimeout(f),document.removeEventListener("mousemove",g),document.removeEventListener("keypress",g),document.removeEventListener("click",g)))},[o,i,r,l,async function(){if(m){const e=Math.ceil((u-Date.now())/1e3/60);return void s(3,l=`Account locked. Try again in ${e} minutes.`)}if(i.trim()&&r.trim())try{const{data:e,error:t}=await $.from("moderators").select("id, username, password").eq("username",i.trim()).single();if(t||!e)return v(),void s(3,l="Invalid username or password");await C.compare(r.trim(),e.password||"")?(s(0,o=!0),"undefined"!=typeof window&&(sessionStorage.setItem("admin_authenticated","true"),sessionStorage.setItem("admin_username",e.username||""),sessionStorage.setItem("admin_login_time",Date.now().toString()),sessionStorage.removeItem("admin_login_attempts"),sessionStorage.removeItem("admin_lockout_until")),c=0,m=!1,s(3,l="")):(v(),s(3,l="Invalid username or password"))}catch(e){v(),s(3,l="Login failed. Please try again.")}else s(3,l="Please enter both username and password")},p,f,a,n,function(){i=this.value,s(1,i)},function(){r=this.value,s(2,r)}]}class F extends e{constructor(e){super(),t(this,e,B,M,s,{})}}export{F as component};
