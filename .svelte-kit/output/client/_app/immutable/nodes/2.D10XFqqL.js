import{S as e,i as t,s,d as n,t as a,a as o,w as i,f as r,l,p as c,x as d,c as m,u,g as v,b as p,h as f,y as h,z as g,j as w,k as I,A as y,m as j,o as _,q as S,n as E,r as x,B as k,C as T,e as D,D as L}from"../chunks/Q9p8_eM0.js";import"../chunks/BzQdJGSh.js";import"../chunks/qLhkP9Nm.js";import{s as $}from"../chunks/BskyxVM1.js";import{b as A}from"../chunks/UorctoEd.js";function C(e){let t,s,a,o,i,l,c,d,m,u,v,p,D,L,$,A,C,V,b,F,M,P='<h2 class="svelte-12inje5">Admin Access</h2> <p class="svelte-12inje5">Enter the admin password to continue</p>',q="Username",H="Password",N="Sign in",U='<a href="/" class="svelte-12inje5">‚Üê Back to Map</a>',W=e[3]&&B(e);return{c(){t=_("div"),s=_("div"),a=_("div"),a.innerHTML=P,o=S(),i=_("form"),l=_("div"),c=_("label"),c.textContent=q,d=S(),m=_("input"),u=S(),v=_("div"),p=_("label"),p.textContent=H,D=S(),L=_("input"),$=S(),W&&W.c(),A=S(),C=_("button"),C.textContent=N,V=S(),b=_("div"),b.innerHTML=U,this.h()},l(e){t=w(e,"DIV",{class:!0});var r=I(t);s=w(r,"DIV",{class:!0});var f=I(s);a=w(f,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-1utotrw"!==y(a)&&(a.innerHTML=P),o=j(f),i=w(f,"FORM",{});var h=I(i);l=w(h,"DIV",{class:!0});var g=I(l);c=w(g,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),"svelte-1wr0xay"!==y(c)&&(c.textContent=q),d=j(g),m=w(g,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),g.forEach(n),u=j(h),v=w(h,"DIV",{class:!0});var _=I(v);p=w(_,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),"svelte-pepa0a"!==y(p)&&(p.textContent=H),D=j(_),L=w(_,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),_.forEach(n),$=j(h),W&&W.l(h),A=j(h),C=w(h,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),"svelte-13remx3"!==y(C)&&(C.textContent=N),h.forEach(n),V=j(f),b=w(f,"DIV",{class:!0,"data-svelte-h":!0}),"svelte-17relh6"!==y(b)&&(b.innerHTML=U),f.forEach(n),r.forEach(n),this.h()},h(){g(a,"class","login-header svelte-12inje5"),g(c,"for","username"),g(c,"class","svelte-12inje5"),g(m,"id","username"),g(m,"type","text"),m.required=!0,g(m,"placeholder","Enter username"),g(m,"class","svelte-12inje5"),g(l,"class","form-group svelte-12inje5"),g(p,"for","password"),g(p,"class","svelte-12inje5"),g(L,"id","password"),g(L,"type","password"),L.required=!0,g(L,"placeholder","Enter password"),g(L,"class","svelte-12inje5"),g(v,"class","form-group svelte-12inje5"),g(C,"type","submit"),g(C,"class","svelte-12inje5"),g(b,"class","login-footer svelte-12inje5"),g(s,"class","login-form svelte-12inje5"),g(t,"class","login-container svelte-12inje5")},m(n,g){r(n,t,g),f(t,s),f(s,a),f(s,o),f(s,i),f(i,l),f(l,c),f(l,d),f(l,m),k(m,e[1]),f(i,u),f(i,v),f(v,p),f(v,D),f(v,L),k(L,e[2]),f(i,$),W&&W.m(i,null),f(i,A),f(i,C),f(s,V),f(s,b),F||(M=[h(m,"input",e[9]),h(L,"input",e[10]),h(i,"submit",T(e[4]))],F=!0)},p(e,t){2&t&&m.value!==e[1]&&k(m,e[1]),4&t&&L.value!==e[2]&&k(L,e[2]),e[3]?W?W.p(e,t):(W=B(e),W.c(),W.m(i,A)):W&&(W.d(1),W=null)},i:E,o:E,d(e){e&&n(t),W&&W.d(),F=!1,x(M)}}}function V(e){let t,s,i,l,c,d,E,x,k,T,D,L,$,A="Placemarked - Admin",C="View Map",V="Logout";const B=e[8].default,b=m(B,e,e[7],null);return{c(){t=_("div"),s=_("div"),i=_("div"),l=_("h1"),l.textContent=A,c=S(),d=_("div"),E=_("a"),E.textContent=C,x=S(),k=_("button"),k.textContent=V,T=S(),b&&b.c(),this.h()},l(e){t=w(e,"DIV",{class:!0});var a=I(t);s=w(a,"DIV",{class:!0});var o=I(s);i=w(o,"DIV",{class:!0});var r=I(i);l=w(r,"H1",{class:!0,"data-svelte-h":!0}),"svelte-1og04w3"!==y(l)&&(l.textContent=A),c=j(r),d=w(r,"DIV",{class:!0});var m=I(d);E=w(m,"A",{href:!0,class:!0,"data-svelte-h":!0}),"svelte-16qhefg"!==y(E)&&(E.textContent=C),x=j(m),k=w(m,"BUTTON",{class:!0,"data-svelte-h":!0}),"svelte-18t49m"!==y(k)&&(k.textContent=V),m.forEach(n),r.forEach(n),o.forEach(n),T=j(a),b&&b.l(a),a.forEach(n),this.h()},h(){g(l,"class","svelte-12inje5"),g(E,"href","/"),g(E,"class","svelte-12inje5"),g(k,"class","svelte-12inje5"),g(d,"class","admin-nav svelte-12inje5"),g(i,"class","admin-header-content svelte-12inje5"),g(s,"class","admin-header svelte-12inje5"),g(t,"class","admin-layout svelte-12inje5")},m(n,a){r(n,t,a),f(t,s),f(s,i),f(i,l),f(i,c),f(i,d),f(d,E),f(d,x),f(d,k),f(t,T),b&&b.m(t,null),D=!0,L||($=h(k,"click",e[5]),L=!0)},p(e,t){b&&b.p&&(!D||128&t)&&u(b,B,e,e[7],D?p(B,e[7],t,null):v(e[7]),null)},i(e){D||(o(b,e),D=!0)},o(e){a(b,e),D=!1},d(e){e&&n(t),b&&b.d(e),L=!1,$()}}}function B(e){let t,s;return{c(){t=_("div"),s=c(e[3]),this.h()},l(a){t=w(a,"DIV",{class:!0});var o=I(t);s=l(o,e[3]),o.forEach(n),this.h()},h(){g(t,"class","error-message svelte-12inje5")},m(e,n){r(e,t,n),f(t,s)},p(e,t){8&t&&D(s,e[3])},d(e){e&&n(t)}}}function b(e){let t,s,d,m;const u=[V,C],v=[];function p(e,t){return e[0]?0:1}return t=p(e),s=v[t]=u[t](e),{c(){s.c(),d=c("\n\n\n// Force redeploy for title fix\n// Force cache clear\n// Force new deployment Wed Aug 27 16:57:34 BST 2025\n// Force fresh deployment Wed Aug 27 17:04:41 BST 2025")},l(e){s.l(e),d=l(e,"\n\n\n// Force redeploy for title fix\n// Force cache clear\n// Force new deployment Wed Aug 27 16:57:34 BST 2025\n// Force fresh deployment Wed Aug 27 17:04:41 BST 2025")},m(e,s){v[t].m(e,s),r(e,d,s),m=!0},p(e,[n]){let r=t;t=p(e),t===r?v[t].p(e,n):(L(),a(v[r],1,1,()=>{v[r]=null}),i(),s=v[t],s?s.p(e,n):(s=v[t]=u[t](e),s.c()),o(s,1),s.m(d.parentNode,d))},i(e){m||(o(s),m=!0)},o(e){a(s),m=!1},d(e){e&&n(d),v[t].d(e)}}}function F(e,t,s){let{$$slots:n={},$$scope:a}=t,o=!1,i="",r="",l="",c=0,m=!1,u=0;function v(){c++,"undefined"!=typeof window&&sessionStorage.setItem("admin_login_attempts",c.toString()),c>=5&&(m=!0,u=Date.now()+9e5,"undefined"!=typeof window&&sessionStorage.setItem("admin_lockout_until",u.toString()),s(3,l="Too many failed attempts. Account locked for 15 minutes."))}function p(){s(0,o=!1),"undefined"!=typeof window&&(sessionStorage.removeItem("admin_authenticated"),sessionStorage.removeItem("admin_username"),sessionStorage.removeItem("admin_login_time")),s(1,i=""),s(2,r="")}let f;function h(){f&&clearTimeout(f),o&&s(6,f=setTimeout(()=>{p()},18e5))}function g(){h()}return d(()=>{if("undefined"==typeof window)return;const e=sessionStorage.getItem("admin_authenticated"),t=sessionStorage.getItem("admin_login_time");if("true"===e&&t){Date.now()-parseInt(t)<288e5?s(0,o=!0):p()}const n=sessionStorage.getItem("admin_lockout_until");if(n){const e=parseInt(n);Date.now()<e?(m=!0,u=e):(sessionStorage.removeItem("admin_lockout_until"),sessionStorage.removeItem("admin_login_attempts"))}const a=sessionStorage.getItem("admin_login_attempts");a&&(c=parseInt(a))}),e.$$set=e=>{"$$scope"in e&&s(7,a=e.$$scope)},e.$$.update=()=>{65&e.$$.dirty&&(o&&"undefined"!=typeof document?(h(),document.addEventListener("mousemove",g),document.addEventListener("keypress",g),document.addEventListener("click",g)):"undefined"!=typeof document&&(f&&clearTimeout(f),document.removeEventListener("mousemove",g),document.removeEventListener("keypress",g),document.removeEventListener("click",g)))},[o,i,r,l,async function(){if(m){const e=Math.ceil((u-Date.now())/1e3/60);return void s(3,l=`Account locked. Try again in ${e} minutes.`)}if(i.trim()&&r.trim())try{const{data:e,error:t}=await $.from("moderators").select("id, username, password").eq("username",i.trim()).single();if(t||!e)return v(),void s(3,l="Invalid username or password");await A.compare(r.trim(),e.password||"")?(s(0,o=!0),"undefined"!=typeof window&&(sessionStorage.setItem("admin_authenticated","true"),sessionStorage.setItem("admin_username",e.username||""),sessionStorage.setItem("admin_login_time",Date.now().toString()),sessionStorage.removeItem("admin_login_attempts"),sessionStorage.removeItem("admin_lockout_until")),c=0,m=!1,s(3,l="")):(v(),s(3,l="Invalid username or password"))}catch(e){v(),s(3,l="Login failed. Please try again.")}else s(3,l="Please enter both username and password")},p,f,a,n,function(){i=this.value,s(1,i)},function(){r=this.value,s(2,r)}]}class M extends e{constructor(e){super(),t(this,e,F,b,s,{})}}export{M as component};
